from functools import cache

recording1 = """???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1"""

recording2 = """????.??.??. 1,1
????#???..?.?? 5,1,1
????????#????#?.# 1,2,3,2,1
?#???#?#?????.?# 11,2
?????.?#??.? 1,1,2
?.???#????????? 1,8,2
?###?.?????????? 5,2,1,1,1
??.???#????????? 2,1,1,7
??#???.????.?# 5,4,1
.?#?.??.????.#??? 2,1,3,3
??#???????##???#.##? 4,1,6,3
?.?#?????#???????? 10,4
.?.??.???.???? 2,3
?#?.?????.???#???? 1,3,3,3
??##????.??#??#. 2,3,1,1,2
?????.????.# 4,1,1
???.??##?????.????? 1,4,1,1,1,1
.??.??.?#?##?#? 1,1,6
???..????.#?#? 2,1,4
#???#?#?#?#?????#.?# 1,2,7,1,1,1
?????...?.???#???? 3,1,6
?????###?.#??#? 1,1,4,2,1
??#??.#??#?.#.#??##? 2,1,1,1,6
.?...#.??. 1,1,1
??..??????????. 1,9
????????#.?#???. 1,3,1,2,2
?#?.???.??????????# 3,1,3,4
?????##?.?#?? 2,2,2,1
???..#?#????? 1,3
.???#???##???##??#?# 10,2,3
??.?.?#??? 1,1,4
##??#??#????????#?.# 10,1,2,1,1
#???#????????#???? 1,1,10
.#?..?????. 2,2,1
?#?#.??#?????? 3,2,3
?????#??#?.#??? 1,7,4
#??.???.?#?????..? 1,7
##?#.?#.?? 2,1,1
.??..??.?????#?? 2,1,8
??##??.??##???#??... 2,8
?#???#.?.????#??? 3,1,1,4,1
???#.?????.??? 1,1,2,2
.??????????? 5,1
????.?#?#????.???. 3,6,3
????????##???? 1,1,7,1
???.??.???? 1,2,2
??#?#..??#?#??.? 4,5,1
.???#?.?????????? 4,7
????????#???#???### 3,1,8
????###?#?? 3,1,1
?.?..#?????##??##?#. 1,2,11
???.????????###???# 1,1,1,12
?.#?#???#...###? 7,3
???.?#??#? 1,5
??#????#.?.#? 5,1,1
..###.??#? 3,1
??.#?????????? 1,2,4
?.???????????.#.?? 7,1,1,1
#??##??.?? 5,1
??#?#????#??? 4,2,1,1
?#??##???#.???#.#? 6,3,3,2
??.?.???#? 1,1,1
?.??.???????. 2,2,1,1
??#????#.# 4,1,1
??.??????#.???#????. 1,1,3,2,2,1
#???.??.###? 1,2,1,4
.?????#?#?? 4,3
.?#?????#.?##??? 2,4,3,1
#???#???#????#. 2,7,1
##??#???#?????.??#?# 9,1,2,1
#?#?.?#.????#???? 1,1,1,2,4
??????#?.?????#?#? 2,1,2,2,5
??#..????#.?? 1,1,1,2
??..#?????#?#??.# 2,1,6,1,1
#?????????# 3,1,3
###??????#???.????? 5,1,4,1,1
?##.??#??.? 2,5,1
.#??#???????.??# 2,4,2,3
.#??????#?????. 2,6,2
??.?###.?#?????.?? 1,4,2,3,1
?????##???? 1,2,1
????????#??##? 1,2,2,2
????????.??? 1,1,3
?????.?????#????##?? 1,1,2,8
.?????.????# 2,4
??##??#?..#..?#?. 6,1,3
???.???.#?#?..#?.# 1,3,1,1,1,1
.?.#####.?.??? 5,1
??##??#.????#?.# 1,3,1,4,1
?#?##???.??. 7,1
.????#?#??????.? 1,7,2,1
.#??#?????? 4,1
?#???????.?##?? 4,1,5
?#???????#?.??##???? 11,4
??#..#...??##? 1,1,1,3
?.?????.?#?.??#?#.? 1,1,1,2,5,1
?????#??????? 6,1,1,1
.??#??????.?##?##?#. 4,8
????.?#??????#??#. 1,1,1,5,2
?#..?.##?? 1,3
?##??????#???.#. 10,2,1
?.#?.???#??.? 2,4
??.??.???? 1,1,3
#?#??#?###?.?.? 1,1,6,1
??#?????#?.?. 3,1,2,1
??????#?.???#.? 7,1,1,1
.????.???? 2,1
..#???.####????#??? 1,5,3,1
?????#..???? 3,1,1,1
.##?#??##? 2,2,2
???????##?#????.?? 11,1
?????#??#.?????? 1,6,1,1
???.#.??#. 1,1,2
#?#??#???####?.?? 13,1
???????..#??#??.?. 1,1,2,5,1
..?#???.??. 3,1,1
??#?#???.? 2,1,2
#?.???.??? 1,3,2
?##...????.?#?. 2,4,2
?.??????????? 1,1,6
#??#????????. 4,3
?.?##?.?#?#?.?.??.?? 1,3,4,1,1,1
??#?????????? 1,1,3,4
??.??.?.##. 1,2
#?.???...??? 2,2,1,1
????#?#???#?##??##?? 1,17
?###???#?????.??.??. 13,1,1
?.??#?#????.##??? 1,7,2,2
..#???#?????#?#????. 6,6
??.?#?.???#??? 1,1,4,1
??#.???#?#?. 1,4
??.???...?????##? 2,7
??#??????.???.?.?? 1,3,1,1,1,1
??#?#?????#??????# 6,3,5
?#???????????? 2,6,1,1
???#???#.??#?.??. 6,1,3,2
??#?##.????.#.???.? 5,1,1,1,2,1
.?#?.??#??.? 1,3
???.????#? 2,2,1
?#???#.#?#?.???#..?? 6,1,1,1,1,2
.??#??.?#. 4,2
?????????.??#???. 1,3,1,2,1
#??.???.?#.?#..?. 3,2,1,1,1
##.??????#??###????. 2,9
?.??#??#?#??...??. 1,8,2
?..???#????#????#? 5,4,3
????#???##???#? 1,2,8
????????#????#??.#? 6,1,1,1,1,2
??#?###?.#?.?? 7,1,1
??..?#?#?? 1,2,1
????????#??#. 4,3,1
.?#.???##..??#?? 2,5,3
????.?.#?.?.?##??? 1,4
????#???#?.?####. 7,4
?.???????#??#? 3,5
#??????.?#.??? 1,2,2,1
???.??.?#. 1,1,1
##?##??????????.? 5,1,1,1,1
?????????##???.#??. 5,3,2
????????#.#??.# 4,1,1,3,1
??.??#??.??# 5,1
?#.???.??.? 2,2,1
?.#??????.#???# 1,4,2,2,1
?##??#??.??..?.? 2,3,1,1,1
????.#??.?#???#?.?. 1,1,2,2,4
????.????#??.????# 2,2,3,1,1
??.??.??.? 1,1
.??.?##??...?#???. 3,3
.?????????#?##..?. 3,1,5,1
?.???#..????? 1,3,3
?.#?.?#.#???? 2,1,2,1
??#??#?#?.??.#.??? 1,7,1,1,2
?#.??#?##?#.?##??#? 1,1,6,2,2
?#????????.?????..?? 9,1,1,1
.????#??#?? 2,5
#?#?.????? 3,1
.???.????? 1,3
????#.???.?#????#??? 4,1,8
???#??????? 1,5
???..?.??.. 1,1,1
.??.?#..??#?.???? 2,2,3,1,1
????.?????? 2,1,1
#.?...?????? 1,1,1,1
##???.#.#?#.##..? 4,1,3,2,1
???.#.#???#.#?? 1,1,5,1,1
?????#?.??#?. 4,2
???#??#.????#?.??..# 1,5,4,1,1
????##????##? 3,8
?##???####?#????..?? 12,1,1
???.?????.. 1,4
?#?????#????##?. 3,5,3
???.?????#.?? 1,4,1
??.#?.???#?.??.? 2,2,4,1,1
?.???????#????##???. 1,1,7
??????#?#???##?.? 8,3,1
.??????#???.? 1,5,1
?????#??...?#??? 5,1,4
.?????.???? 4,2,1
????.#??.???????? 3,3,1,1
#????????##????? 1,8,1
??.##???#? 3,2
?#???..???????? 3,1,2,1,2
?.???????? 1,2,2
??#?.##??????#.?#??? 1,1,9,4
?#?#?##?.#?. 6,1
???#????????#?#?.?? 2,1,3,1,2,1
??#??#?????#??? 4,4
?#?.?##??#..?##? 1,6,3
????##?..?.#? 6,1,2
??##??.?#?.?. 1,4,2
???##????????? 1,4,3
##?#??.????#?###???. 2,2,3,4
???##???#.??? 5,2
?..?#?#?##?#????#??? 10,1
??.???##?#??????? 1,7,1,1
?..#????##?. 1,4
?????.??#? 1,1,3
?????.?#?#?##??.??#. 3,8,3
.??#?????.##????##. 7,2,1,3
.?????#?.?.??.? 1,2,1,1
?#???????????.?#?#? 4,7,4
??.????#?#.#??. 1,1,3,1,1
???#????.?? 6,1
?????.???? 2,2,3
?.#????????.?.? 4,2
??????#?#???##??#?? 1,16
??#???????# 5,1,1
?..#?.?#??#.??????? 1,2,1,3,3
?.??#??#?.??##?? 1,1,5,5
?..?????##??????#??? 1,1,8,1,1
?.#?????##??#.?? 2,5,1,1
.?#?#.?.##????#?? 4,1,5,1
#???????#??#.?#??. 4,7,1,1
#????.#???##.? 5,2,3
?????????#?##??????? 2,1,11,2
#?.#??????????#? 1,4,4,1
??#?#?.#???.?##????? 5,4,4,2
???????##??.? 2,4,1
?.#????????..?? 1,1,1,2,1
??..???#??#??#?#??. 1,8,5
?#?#??.#?#?? 1,1,4
?.?.#???.???. 1,2,3
???..?.?????.? 1,5,1
???#??##?#?? 8,1
.???#?.?.? 4,1
#.#???.??????#?# 1,3,3,4
????????#.??? 1,7,1
??#???##??? 1,5
#????????#? 2,3
.????.???#?.??#? 3,2,3
?.?#.??#?.##???? 2,2,6
??#???.???.????. 2,1,2,1,1
.???.??.???####?? 2,2,1,7
.?????#??#???? 2,3,5
??????#??##? 2,1,2
..?.##??.??#?.# 1,2,1,3,1
.??#?.??.??#??. 2,1,4
?.??????#?#???#?? 10,2
??????#??????????#?# 1,1,15
?????#?###??..?? 3,7,1
???#??????#?.# 5,2,2,1
??#??????##??#??.??# 6,7,3
#????.???#.????# 1,3,2,2,1
.#?.?.?.?. 2,1
#?????#..??# 4,1,1,1
?#??.???#?????#?# 1,1,10
?.#???#?##? 2,6
...?.#????#???# 1,1,2,1,3
??.??????#???.?.? 1,1,1,6,1
?#???#??.??? 3,4
.?#..???#??? 2,3
.?#??????.???##? 2,2,1,3
?#?#..??????.#?#??? 4,1,2,1,4
?.??.????. 1,1,3
???.?.??????#?#??# 2,1,9,2
??..??#..?#????##??. 1,2,9
??#?..??.? 1,1
???.???.??. 1,3,2
.?###????? 5,1
??##??#???# 7,2
.?###??#?#?#?#?#?? 8,1,1,1,1
???###???##?????#?. 12,2
.?#??.???###?.? 3,6
?..?#.???#???.. 1,7
???.?????#?#?###? 2,12
????????#??? 1,3,1,2
????????##...?.?? 1,3,3,1
..#??..#???? 2,4
?.??#???????#? 1,3,4
???????#??.?# 9,2
????..????##??# 3,9
????.??#??#?#??????? 2,15
?????#??#??.## 1,2,1,2
??????#.??#..?.# 1,3,1,1,1
#??????.??#?#?? 5,1,1,4
???##?????#?#?..?#? 9,1,1
?####???????#? 4,1,3
????#?#?.??##???? 8,1,5
.????#?.?.? 4,1
????##???.??#?.?. 6,3
.?#??#?????......??? 10,2
???.?#.#?##????.#?? 3,1,1,4,1,1
?.?#??.??.??#? 4,1,1,1
??##????#?? 4,4
.??.?#?#???##?? 2,4,3
??#??#?????# 7,3
?#?#?.???????#.???# 4,1,1,1,1,4
?.???????##??? 5,3,1
#?.?##?.?. 1,2,1
????????##???##????. 2,1,10
#.#?###????????? 1,13
???#??#??#???#.?.?.# 5,5,1,1,1,1
????##.?#???#?????## 5,1,4,2
#??????????#. 1,1,6,1
#?#.??????????#? 3,1,2,5
.?.?????.??.? 3,1
###???.####???#??# 4,1,4,1,1
?###????.?????.?#? 7,1,1,1,3
?#.#??#??.?.?????? 2,5,1,3,1
#??.????..?##?.? 1,4,4
.??.????#. 1,1,1
..?.#?#????#. 1,1,4,1
..#??????#?????? 2,2
?????.#???.???.#?#? 1,1,4,1,1,2
?#??.#.????.#??????? 2,1,1,2,3,3
?????.##?##???? 1,1,6,1
???????#?#######??# 3,14
#.#??#?##??##??#?? 1,12,1
.?#???.??.????#.???? 5,1,1,2,1,1
??.?#??#??? 1,5
.??????#??#????? 1,10
?#????????????? 4,9
??##?????.?#? 6,1,2
??..??#?#? 1,1,1
?.?..#????. 1,3
?.?.??????#??#?#???? 1,1,1,2,1,8
?#.?.?.???#?#.#?? 2,1,1,5,1
????#???#?#?.?? 11,1
#???????????#????# 14,2
?.??#?..#? 3,2
#?.??##?????#???###. 2,4,3,4
???.?#?.#??? 1,1,3
??#.???#??##???#?#?? 1,13
?#.?#????? 1,2,2
?.??????????#?#?? 3,6
?#?.??.???#..?????? 2,2,1,1,1,3
?#?????.???? 1,2,1,1
??#??.?.?##???? 1,7
?###???#??? 5,1,1
???#???#?.#???. 8,1
??.?#..??#?#.?. 2,2,1,1
??????????? 3,1
.????#??##?????##? 7,4
.???????##???????#? 1,7,8
????.?#????.??. 1,1,1
??#???#?.?.?.????# 7,5
???.??#??. 3,3
#??..?#.???????????? 3,2,6,2,1
???#????????? 4,1,2,1
???#???##????????.. 1,13,1
?????????? 1,3
?#?.??#???. 2,5
??.???#??### 2,4,3
.????#????#??#? 4,1,5
?.?.???##???#?#?. 1,5,6
.##??.?#??? 3,4
????????#???.? 4,4,1
?##??????.??. 4,1,1,1
##????????###?#.. 2,12
????#???????.?? 6,2,1
.??####???#..???? 10,1
?.#???#?#??#??#??.. 1,2,3,2,3
????.??#?#??????? 1,12
?#?#?????? 1,1,1
?#?.?..#?.??#.? 1,1,1,2,1
???????..?.? 1,1,2,1
?#??????#?#.????..?. 1,7,3,1
?#?????????.???? 1,6,1,1
.???#????..#? 1,1,3,1
???????????##????? 2,12,1
????????#.? 5,1,1
????#??#?.?#. 4,1,1
.??#?#???.. 2,4
.?????????#.??.?#? 4,1,1,1,1
????#???#??.?#.?#? 9,2,2
??##???????#???. 3,5,2
????.??.?. 1,2
??#???#?#???? 1,8,1
.???##?????#.?.#? 5,3,1,1
#??????##.??#?? 2,5,5
#?##?????????.. 10,1
???#?##??#???#?#??? 1,14
???#?##????? 1,1,7
#?#?#.????? 3,1,3
??????.???????? 1,4,1,2
?#????#?????#??? 8,3
.?#?#?#??#? 1,6
.??#?#.???#?????? 1,1,1,2,4
.??#?.#??????##?? 3,1,1,3
????.????.???.???.?? 3,4,1,1,2
????#??????.? 1,5,1,1
??#??#??????#?#???? 3,1,10
.#???###?#???..? 1,5,1,1
#???#???????#?# 2,2,5,1
??????????? 1,2,1
????##?#???.#????.#? 1,6,3,1,1
?##??.#??. 2,1,3
?.???##??#?#??#??.?. 10,1
???#??????#?#??????? 2,1,8,1
?#????#?#??????.?. 8,3
??.????#???# 1,1,1,2
.#?????.????..#? 6,1,1,1
.#?????##?# 2,6
?#?????????. 2,5
??#??????????#.?#??? 5,2,1,2,2,1
.??.#.###.#?. 2,1,3,2
#?????????????#???? 1,7,1,1,1
???#?#?#?#??????#??? 8,1,5
???.?????.????????? 1,1,1,1,4,3
???..?.???????#? 1,1,1,4
??#???#?.? 2,2
.?#?????#????? 1,1,4,2
..????#???#? 1,1,3
????#?##????#. 2,6,2
?##??????##?.##? 3,6,3
???.?????#?#???? 2,10
??.???????? 1,4
?.?????#?? 1,3,3
#???#???#?? 1,7
??##???##?.. 4,3
??#??????#? 2,1,1
?#.?#??#??.#??.??# 1,3,1,2,1,1
?.###?.#?.??## 1,3,2,2
????#?.?..???#? 1,1,1,2,1
?#.???#??????#??#??? 1,1,5,1,3,1
#..???##????? 1,5
.???#??#?##????###?? 12,3
.#???.?#?????#? 1,1,3,1,2
#.??????#?.??#? 1,8,3
???????.???.. 1,1,3
??????????????#? 1,3,1,3
??.?#??#?##?.?? 1,1,5,1
##?###?#???? 2,7
??????#..##??#.?# 3,5,1
.?.#???#???#??#?#. 1,7,1,1,1
.#??#???..?????# 1,5,4
?.???.??##?#??#?#? 2,10
???#?.??#???#???..? 4,9
???##?#??#???#???. 2,9,1,2
???.????.?.???##???? 3,1,7
..???????. 3,1
?????#?.?????. 6,4
.?#???#???##??.#?... 11,2
?.????##????? 5,3
.#??.??#?#??#? 1,1,4,2
??#?##????????????? 6,1,4
?.?????#?? 1,2,4
???.#.????#?#?? 1,1,6,1
??.?#??????.????? 4,2
?#??#??????#? 7,4
????????#?? 1,1,3
...??????..?#????. 5,5
???..?#??. 1,2
##..?..#.#???. 2,1,1,4
??###????.? 8,1
?..???#??.????..? 5,4,1
???#??..#?# 1,2,3
????#??#???.#.#?. 9,1,1
##?#??#???#.??? 11,1
???..????##.#..?#.?? 3,1,4,1,2,1
????.??#?? 1,3
???#?????? 5,3
?#??#??????#?.??.#?? 1,4,3,1
???##???..??? 6,1,1
??#??#?????#?? 8,2
???.#??.?# 1,1,1
?#?.??.????. 3,2,1,1
.???#??#??? 1,5
?#????###??#?.# 3,7,1
??#?#?#?.??????#? 7,1,2,2
?###??#?#?? 3,3
#?????#???.???? 1,5,1
?#??.?#???? 1,4
?#????#?..#? 6,1
????#.??#?? 4,3
#?????#?????.???.#. 2,8,1,1
.??#??????#?#??? 3,7
??##??#?.????# 1,6,2,1
????#??????##??#?? 1,1,13
.?.??????????#??..# 11,1
????#???.??? 3,1
#??#.?.?.? 1,1,1
?.#???.???????#..? 4,5,2
?#????#?..?#????#? 3,3,2,2,1
?????.#?????#???# 4,7,3
.#.????.??. 1,1,1
????.##?.?? 1,2
???????##?#?? 1,8
???.?#???#??##????. 1,2,1,1,3,1
.??????#???#?##?##?? 1,13
.??????#??###?.????? 11,2
??.???.???. 1,3,1
???##??#..##? 5,1,2
??#.##????#?##????? 1,1,3,6,1,1
??##???#?.#??##??.?? 7,6
?##??.???.??.???# 4,1,1,1,1
???.???.?#?##???#.?# 1,1,8,2
.?.??#?#?.#??. 1,5,1,1
?#???????? 3,2
?.?#?#???? 1,2
??..#???#.?.?#? 1,2,1,1,2
?.???#????...?#?? 4,3
?#?#???.????? 4,4
??#??#.???? 5,1
.?#??#.?.? 1,2,1
????????#??#???# 4,1,4,1
#?#????#?#?. 3,3
.?????.??#.?#? 5,1,1
#?.??#??#?.?.???. 1,6,1,3
?##??????# 5,1,1
.?#??#???.????#.?# 7,1,1,1
???#???????# 3,1,2,1
???#?#?????#?#.?? 7,3
???.??#??? 2,1
#????????##?????? 1,2,10
??#???.??. 6,1
?#?#.??#???? 3,4,1
???#?##???.??? 8,2
?#???.#??????? 2,2,4
?????#???. 1,4
?#???????#???#.?. 1,5,3,1
?#?.?#?#?????. 1,3,1
?.??.?#?#??##???? 1,1,10
???????????#? 1,4,1
##?????#..??#?#?#.?? 2,3,1,7,1
.#??.?#????? 2,1,3
.????#?.?.##???.? 4,5
?#.???#??#?#??#? 2,11
????????.?#?????#??? 7,3,4
?.??##????.??. 3,3,1
?#???#?#?#????? 2,8,2
???.#??.???#.?#. 3,1,2,1
.???.#.?.?. 2,1,1
?#???#???.??.. 5,1,2
?##?????#?##????#?. 9,2,1,1
?????#.?????. 2,2
.???##??#????#?#?.?# 2,13,1
??##.???.??.#.????? 4,2,1,1,1,1
#?????.?#???#??????. 3,1,1,1,3,1
???#?????.???? 4,1
###?###????#?.?#?# 9,2,2,1
????#??#????#.?? 11,1,1
??#????#?? 1,1,1
??.???#??.?????? 3,1
???#?????.#?#??..?# 7,4,2
?.##.??#?? 2,4
#.?.#?#??????.#??. 1,4,1,1,1,1
?##???#?#.?#?. 9,1
?????????????? 1,7
###?.##??#???? 4,8
??.#?#???#?#??????? 2,7,2,1,1
?????????? 1,1,2
??#??#?#??##?? 6,3
?#???#?.##?#??? 6,4,1
???????#?.???? 9,1
???##?????##?#.?.. 1,11
#????#?.????.?#????? 1,3,2,1,2,2
???.#???#????#??#?? 1,1,1,1,1,5
??#????#??#. 1,3,3,1
?#?##???#?. 1,3,1
#??#??##?#???????? 12,3
.???..??.##??? 2,1,4
?#??##?#?? 1,2,2
?????.?.#? 2,1,1
?#???????.????## 1,1,3,6
????#?#.???#?#?.?# 1,3,6,1
.??#?.??#? 2,2
?#??#?????.??? 1,4,1,1
?.????#?????#???? 1,1,1,9
??#?????.? 2,4,1
??.???#?#????.##??? 1,7,4
.?#?#????#?#???????. 4,11
.???.??.#.###????? 1,1,1,6,1
?#????????.???#????? 1,4,5
..#???.???????# 4,3,2
??????#????..#?.??. 4,2,2
????#??#???? 2,1,2
??..#??###?.?###???? 1,7,7
??#???.?????? 2,1,1
?.???.???..?. 2,2
..##???.?????.. 3,1
?.??.?.?????#???? 2,8
??.#??###?#??????#?? 1,8,1,1,1,1
?#####?#???????? 6,1,1,1
?.?.?????#?????? 1,2,3,4
?#??###?.?.? 3,4
.????##??? 1,5,1
?????#?.#?.#?#?? 4,1,1,2
.????#???#??#?#?.?# 4,7,1
????#?.???.?#? 1,1,1,3
?????.??????## 1,1,1,3
?.?##?????#????#?? 2,10
.??#????#??.?????.? 1,6,1,3
????#???.?.??#.. 2,3
??#??#??.?????????? 6,1,7,1
.#??#????????#??? 2,8,3
???????####???.#???? 1,7,1,3,1
????.?.?.#???#?? 2,1,1,2,3
??.?#?#.##??.#???.? 4,2,4
??##?????????? 2,3,3
??????##?????#??..? 3,2,2,4
????.??####?#???? 1,9
#?#????###?#??.?? 5,3,2,1
?#?#.??#??.?.#?. 3,3,1,1
?????.##?. 1,2
.????????.?#??#. 2,1,1,1,4
???#??.?#????? 1,3,1,3
????????.?#####???.? 3,8
????#???.??#??##?#? 1,2,9
.?#???#??.#? 6,2
??#????#?? 1,7
??#?..???.? 1,1
#???.??#.?#???.# 1,1,3,2,1
???..????#? 1,5
?????#????? 2,1,1
??.????#????? 2,2,1,1
????#?##?#??#?.. 8,1,3
.???????.#?..? 2,3,1,1
?????#????#??#?.??? 6,5
.????#?#?.? 1,5
?..?#???#?????.???? 1,7,2,1,1
??#???##?.?#?.???? 8,2,1
?????..??##?.?.? 1,3
#?????#?..??..?? 8,1
?.???#?#??#??????? 1,7,1,3
#??#.??#??? 4,4
???.?.??..?#??????.? 2,1,7,1
????.?#?#????##??.? 1,12
??????###?.??.??# 3,6,1,2
??.??##.???? 2,1,2,2
??#?????????###??#? 3,6,3
.#??.?#????? 3,1,1
#??????????. 1,1,4
??????.?#?? 5,2
???#?.#?.? 1,2,1
#??????#???????#?.? 1,12,2
???????#??.? 2,1,2
..?##..?.??.? 2,2
..?.??#????#?????.#? 12,2
?.#??#???.#.??# 2,1,1,1,2
?#..???#???????. 2,9
?#???#???????.#.. 1,8,1
??.??#????? 3,2
.??????#????#? 2,8
?.????.?.#?#?#?#??.. 4,7
.....??#???????## 7,3
?.##???#.#????...?? 6,1,2,1
??..?#???????.# 2,1,1,1,1
.????????.???#?????? 1,2,1,9
?.??.?#???????.#?## 1,1,3,1,1,4
#?.??????#???????#?? 2,1,3,8
.????.?.#? 3,1
.??.?.??#?##?#????.? 1,11
??#?#.?.????#??????? 3,1,1,5,2
..##????.? 2,3
????#??#???? 2,1,1,1
?????.?##? 1,1,3
???.#???.?#???# 1,2,3,1
?##.?..?#??? 2,1,2
??.?????#??#??.? 2,3,1,3,1
#?##?#??##?.???.?? 1,9,1,2
??.??????????#.?# 1,1,5,1,1
..?####??.#?#?#??#?? 4,1,8
?#?.??????##???? 1,4,3,1
?.????##.???#?? 1,2,5
???#????????#??# 2,4,1,1
????#.??#.?? 5,2,1
?.???#?#???#?.?#?#.. 1,1,1,6,4
.?????#?.#?????????# 3,2,1,9
????..?????...#?? 3,3,2
.??.?.?#??. 1,2
??.#???#?????#??#??? 1,7,1,1,1,1
??..#??#?#?##???#?#? 2,2,1,1,9
????#?????????.?.? 1,2,4,2,1
???#???.#??#???#?## 1,1,1,6,4
#??##??#??.#??????? 9,2,3
??.##?##??#??####?.? 8,5
???#?.#.#?????? 1,1,1,1,4
????????????#????? 2,3,1,2,1,2
??#.?##??#?#???? 3,5,2,2
#?.??????#????????? 2,1,2,2,3,1
??.??#?#??.?#.#. 2,2,3,2,1
.??#?????? 3,1,1
???.??.?#????#?? 1,2,2
##???????#?#.??. 4,7
????#.#?##?#????# 1,2,11
???..???#..? 1,3
???#????#?##? 2,7
#??????#??# 1,2,4
.???#?.???#?#? 1,1,1,4
??????????#?##? 1,10
..??????#.##? 1,1,1,2
?#.??#?#.??#?#?##? 1,1,1,7
.??#.?..?? 1,1
???????????#??..#?## 8,1,1,4
??#.????.? 2,1,1
????#??????.???? 8,1,1
.???#??.##? 1,1,2
#????????#?? 1,1,1,4
...#????????. 4,2,1
.??????#?#?.? 4,4
#.??#.?#?. 1,2,2
.?????#?#????#?##? 1,5,5
??..???#?????? 1,4,3
.???????.?????#...?? 6,2,1,1
???#??.???#??###?? 4,8
??.??.#??????#????? 2,10,1
?#????.##?.##???.?? 1,1,2,3,1,1
##??###??##??#?.? 12,1,1
???.?##?##???????#.? 1,7,3,1,1
.????..#.. 2,1
?#?#??#.#?#?????.?? 7,3,3,2
..??#?#????.? 6,2
?#?#??.##???.???? 2,2,5,1
###.?#???? 3,1,1
.?#?????????#.?.# 5,3,1
?.?#####?##.??????? 9,3
.????.#????#?.?. 3,7,1
??.???.????#?? 1,3,6
?????????. 1,1,3
?#.?????.??# 1,3,1,1
#?.????##??????#? 1,1,9
??#????.?##??.?? 6,4,1
.#???#.#??.#???. 5,1,1,1
..#????##???#?? 2,9
?.???.???#???#.???# 1,1,4,1,1,1
#??#?###?#?. 1,7
#.?#?.?#??#?#?? 1,1,1,4
??#?#????.?????? 5,1
.???#?????#??#? 1,3,5
##?.#?#?#? 2,3,1
.?#????.?????#? 2,1,1,4
?#??##??#.????.? 2,3,1,1,1
???#??.??# 5,2
????#?????#??? 3,1,4
.?????.?#?#?.???? 4,5,1
.??#??.??????# 2,5
???#?#??#??#?#??#?. 3,9
.?##??.?.????##???.? 4,4
?##?.#.???? 2,1,2
???.?.?????#.#?.#? 1,1,1,3,1,1
??.#?????#? 1,8
#??.#??..??? 2,1,2
#???????##????? 3,6,2
##?.????## 2,1,4
?.#.?.#??#?? 1,1,1,2
????.?.??#?..? 4,1,3,1
??.?#?#????#? 1,5,1
#?????#.???#???#?? 1,1,1,1,1,7
??#?.#??.?..??? 2,3,1,1
???#????#?##???..? 3,7
?????..?????? 4,4
?##?.????????????# 3,2,1,1,2
.????#?.#? 1,1,1
#??????.?.####????? 1,1,3,4,1,2
????.###?.? 3,4
..?.#?#???????#???? 1,10,1
???.?#.?????? 3,2,1,1
???#?#???..?.#? 8,1
.??.?????#?????#??? 1,1,10
?????????#.?#???? 2,2,2,1,1
??.???????#??????? 1,4
?.#?.??#??# 1,4
??????.??#????#?. 6,4,1
?..?.?????#. 1,1,5
?????##??#?.????..?? 7,2
?..###.??#?#???##?#? 3,11
?.#?????.?#??#?????? 1,6,7,2
??#.?.????#??#??#?# 1,1,1,8,1,1
?.??#????#??..#? 1,1,1,5,1
???#??????#?.????.?? 1,3,6,1,1,1
??#.#.#??#???#?? 2,1,9
??#?????#?? 6,2
#?#?##?#?#.#?#?????? 8,1,1,1,2
???.????#??#?#?? 1,4,6
.??????#???#??? 3,8
??.??#?#?????? 1,1,6,1
??.??#?.????.??. 1,3,1,1,1
..????#??#??. 1,8
?#?#....?# 3,1
#??#??#???? 7,2
?????????#???.??#?. 1,1,5,1,1,2
#?.??#??##?#???? 2,7,1,2
.?#.??#??#???? 1,9
???#???#?#?#?#.????? 2,1,7,1,1,2
???#???#??????#?.# 1,2,2,1,1,1
??#???.???.?????? 3,2
???#?#??????? 7,1
#??????????? 5,2,1
#???.#?#?#? 2,6
??.?.?????#? 1,6
????#????? 4,2
#.?#????##???.???? 1,9,1,1,1
.??????#??#??# 1,10
.??#?....???? 2,2
??#??#?????#????? 1,1,8,1,1
???##.??#? 3,1
?..???.##?##?###?..? 2,9
#??#??????????.?? 1,6,4
.??#???#??????????? 7,4
???#????##?#?#??.#? 1,3,5,1,1,2
#.??##??????##?#??? 1,5,6
?#??#???.??#???##. 7,1,1,3
????.??#?.? 3,2,1
????????.#.# 7,1,1
?#??###.?#??#? 6,4
?#??#?#?#??????.? 1,6,2
?????.???#?#.? 1,1,5
???##?..?#. 4,2
.???.??#???. 1,5
.#??#.?????#. 4,2,1
#????.#?.?#??????### 1,1,1,3,1,3
????????#?#?. 4,1,1,2
#.?.??.????? 1,1,1,1
#????#??.????#??? 1,3,5
?#?.??????? 1,3,1
?.?????.?#???.?? 3,5,1
???????#??...#.? 7,1
?.#?#??.???.?? 1,3,2,1
??#????????#???.? 2,8
##???#???..?????.?#? 9,2,2
?##.??????? 2,1,4
???#??#??##.?? 1,2,2,1
#??.#?.#..?.???#?? 1,1,1,1,3,1
.?#?#??#?.?#??#????# 4,3,7,2
????????#??????... 1,1,6,1,1
.????#?#?##. 2,6
???##???.????. 5,1,3
.????????????? 1,3,2,1
?#???.#?????????#. 2,1,1,2,2,1
?#??????.????? 8,1,2
.?##???????#?? 9,3
.???????#?##??#??. 2,11
???#.?????#?#?#??? 1,1,9,2
#???..??.?????.?? 3,1,2,1,1
.????.?#?????####? 4,11
????.????.?????.. 3,2,1,1
???#?#?#??#???#??#?. 1,5,9
.??##???#?#?????. 9,1
?#.???..#????#??? 2,1,1,3,1
?.?.??#????##? 1,3,3
.#.????????.?.#? 1,7,1
??????#??????? 1,5,2
?#??###???#? 1,4,2
?.....?##.? 1,2
.##.###??##?#????. 2,10,1
???.???????##?? 2,1,1,3,1
??.?????????.?#.??? 1,7,1,1,2
?####.??.##????##. 5,2,3
?.??#?????? 2,3
?????.???##?#??.? 1,5
??#?.?.???###. 3,1,3
.?##?#?.???#???#?? 5,6
?.?.#.#??#?????? 1,1,1,1,7
#?????.????#?#??? 5,6
???#.???#?#.? 3,4
#???##.##????.??? 3,2,6,1
?.??????..??????? 1,1,3,2,3
?????????## 1,1,3
????#????#.?##??#??? 5,1,2,6,1
???????##?#?.?. 1,1,6
??##?????.??? 6,1,1,1
??#?.#????????#?. 1,1,1,2,3
??.?#??#??????.? 1,4,5,1
.?.#???????##?? 3,1,3
?????#??.?.??#.??# 1,4,1,1,1,2
?..?#?????#??#?#. 1,2,1,6
..#.????#?????? 1,2,6
????..?????# 3,6
??#?????#??.? 9,1
#.??.##??.##.? 1,1,3,2
##?????.???? 3,1,1
?.?????#?#??.???#?? 1,2,5,1,1
??##?.???.??? 5,1,1
?.????#???.? 1,3,2,1
??#????.#?. 5,1,2
????..??????.?#??? 1,1,4
??#?.??#?.. 3,2
?#?.????????? 1,5
#??.?#??#?.?? 2,6,1
??.?#??????? 1,3,1,1
???#?#??#??#?????? 11,3
.###???..???#??? 3,2,6
??##????.. 3,1
#..?????????#??###?? 1,1,1,2,1,4
#.????#?##? 1,2,5
????.##???????#??. 2,2,2,4
?.?????##?. 1,4
???..?..?..???# 2,1,1,1,1
??..##??#?#??. 3,5
?..#???#?.?????#? 1,6,1,1,2
???.?.????##?#??#?#. 1,1,1,2,4,1
??..#??.?##?? 2,1,1,3
?.?.???...?.??#??? 3,4
.??#???##? 2,3
???.????#?? 1,3
??#??..?#?..? 5,2,1
???#.???.????..?## 1,1,1,4,2
?.?.#.???#??##?????. 1,1,11
#.??.#.????? 1,1,1,1
????#?#?.??. 7,2
#??????????#?.??? 4,4,1,1
??.??#?.???#?.?.? 2,3,2,1,1
.?.#??????#?. 1,3,2
????????##??.???#? 1,8,3
.????..?.???????? 1,5
????#?##???? 2,4
?##.#.???#..??#?.?# 2,1,2,1,3,2
.??#.?????..#?? 1,1,3
.?.?#??.#??? 1,1
??##????????.?.??? 9,1,1
??##..#..??? 3,1,2
.???????????? 2,2,1,1
.????#????#??#??#### 1,1,1,11
#??##?.??.???.???#?# 1,4,1,2,3,1
??#??????. 1,1
.?#?.?.???????????? 3,1,4,5
???#..#???.?# 3,3,1
???????????? 3,1,1,1
.#????.?###.?.?????? 1,2,4,3,1
????#.###?#??? 4,3,1,1
?????#?????#?..???? 1,1,2,1,3,4
?...#??##?#?.? 1,4
???????????????#??? 1,1,6,4,1
.??????#??#??????. 3,8
..???????? 1,1
#?#??#.????.?? 4,1,1,2
#.#.?????#?#??????? 1,1,1,9
.?..#?#?#????.?? 1,9,1
##?#??#??#??#.???? 11,1,1
???.???#??#.##??#?? 1,7,3,2
??..?#.??#?????#??? 2,1,4,2,1,1
?#?.???.#??? 2,1,3
????#?.?..#?.??#??? 1,2,2,5
.?????.?#?? 1,3
???.?.??##? 3,5
?#?.?????.???? 3,1,1,3
?.???#?.#??## 1,1,1,5
????.?.??? 4,1,1
????????.. 2,1
???????##?.?.??. 3,1,2,1,1
?#????#.????.#. 2,2,1,4,1
??.#??#??#???#?#?? 1,1,5,5,1
.????.?????#? 2,3
???.??#?#????.?#??#? 1,4,1,1,6
??.???#???#????.?. 1,2,1,2,1,1
???????##???##? 3,2,5
??.?#.???????. 1,7
..??...#????.?? 2,4
?#??##??.?#?? 5,3
???..#???. 2,1
?.?#?#?#?#??.???.#?# 1,9,1,1,1,1
????#??#?#??? 3,6,1
.???..????# 1,2,1
????#??..??????? 1,1,1,1,7
??????????#?# 1,2,3
.???#??????#??????? 1,12,2
??#?????#..#?? 2,1,2,3
?.?#???#?##????#. 1,1,1,6,2
??.?#??.??#.??##?? 1,4,3,2
.??#?????????#? 9,2
???????#??..#?..?. 5,2
#??.??.?#?#??#?? 1,1,2,8
?????.????#????# 2,9
??????#??.. 2,3
??????..?#??#? 1,5
????????#??##??? 1,1,1,1,3
???#???#???.?# 1,8,1
??????.?#.??.?. 1,1,1,2,1
??.###?#?????????.?? 1,5,3,2,1
.?????#???#????? 11,1
?###??##?#???#.??.? 12,1,1
????#?#???#?#???? 4,8,1
???.?#?#.?? 1,3,1
#?#??#.??.?#.????? 1,1,1,1,2,4
#?##?..#?## 5,4
????#?#..???#???##. 4,4,3
##?.?##???????? 3,2,5,1
.??#?####.## 1,4,2
???#?#??.??????? 1,3,2,1
?#?#??????.? 2,1,1,2
#?????#????#? 1,6,1
??#?????##..??.#???. 9,1,1,1
#??#?????????.?? 1,6,1,1,1
??.???????#???? 1,1,1,2,1
???#.??#??#?? 2,1,7
??????????????#??#? 3,1,2,1,1,1
???##??##???#??#?? 1,3,10
??????#??#? 1,1,5
?????.?#??.????.?. 3,4,1,1"""


class Row:
    def __init__(self) -> None:
        self.springs = []
        self.groups = []

    @staticmethod
    def create(string: str, factor: int):
        row = Row()
        row.springs = list("?".join([string.split(" ")[0]] * factor))
        row.groups = [ int(spring) for spring in string.split(" ")[1].split(",")] * factor
        return row
    
    def __str__(self) -> str:
        return f"{''.join(self.springs)} {self.groups}"
    
    def get_possible_arrangements(self) -> int:
        arrangements = 0

        # new algorithm = GOOD?
        def check_group(i_spring, i_group):
            if i_group >= len(self.groups):  return 0

            start = i_spring
            length = self.groups[i_group]
            end = start + length
            group = self.springs[start: end]
            next_element = self.springs[end: end + 1]

            #group to short
            if len(group) != length: return 0
            #group at the end
            if "." in group : return 0
            #group to long
            if "#" in next_element : return 0

            if i_group - 1 == len(self.groups):
                if end == len(self.springs): return 1
                if end + 1 == len(self.springs) : return 1

            return check_spring(end + 1, i_group + 1)

        @cache
        def check_spring(i_spring, i_group) -> int:
            if i_spring >= len(self.springs): return 1 if i_group  == len(self.groups) else 0

            result = 0
            spring = self.springs[i_spring]
            if spring in ".?":
                result += check_spring(i_spring + 1, i_group)
            if spring in "#?":
                result += check_group(i_spring, i_group)
            return result

        arrangements = check_spring(0,0)

        # old algorithm = BAD
        # num_unknown = self.springs.count("?")
        # # iterate to all possible combinations
        # num_possible_combinations = pow(2, num_unknown)
        # for try_nr in range(num_possible_combinations):

        #     # replace each ? with a # or . of the current arrangement
        #     binary = bin(try_nr)[2:].zfill(num_unknown) 
        #     try_springs = ["#" if bit == '1' else "." for bit in binary]
        #     filled_spring_row = "".join(self.springs).replace("?", "{}").format(*try_springs)

        #     if Row.validate_row(filled_spring_row, self.groups):
        #         arrangements += 1
        
        return arrangements
    
    @staticmethod
    def validate_row(row: str, groups: list[int]) -> bool:
        blocks = row.split(".")
        blocks = [len(block) for block in blocks if block != ""]

        return blocks == groups


class Recording:
    def __init__(self) -> None:
        self.rows = []

    def __str__(self) -> str:
        return "\n".join(str(row) for row in self.rows)


def read_input(string: str) -> Recording:
    rec = Recording()
    rec.rows = [Row.create(line, 5) for line in string.splitlines()]
    return rec

def main(recording: Recording) -> None:
    sum_arrangement = 0
    for row in recording.rows:
        sum_arrangement += row.get_possible_arrangements()
    print(sum_arrangement)

main(read_input(recording2))